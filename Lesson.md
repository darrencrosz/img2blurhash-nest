# 项目经验与教训积累

## e2e 鉴权与 token 作用域问题（2025-04-28）

- e2e 测试涉及 token 时，务必在 `beforeAll` 或 `beforeEach` 阶段统一获取并赋值，避免作用域和时序问题导致的 401。
- 遇到“幽灵断言”或 jest 行为异常，优先排查 token 变量作用域、jest 缓存和进程残留。
- 若用例依赖全局变量（如 jwtToken），应保证其赋值在所有相关用例之前。
- 清理 jest 缓存、重启终端可解决部分测试 runner 状态异常。

## nestjs 路由与版本规范
- 所有 API 路由均应加全局前缀 `/api/v1`，并补充 OpenAPI 注解，便于文档自动生成与接口一致性维护。
